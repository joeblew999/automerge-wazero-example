<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automerge WASI Demo - Complete CRDT Showcase</title>
    <link rel="stylesheet" href="/web/css/main.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1>üöÄ Automerge WASI Demo</h1>
                <p class="subtitle">Collaborative CRDTs powered by Rust (WASI) + Go (wazero)</p>
                <div class="status-indicators">
                    <span id="connection-status" class="status-badge disconnected">
                        <span class="status-dot"></span>
                        Disconnected
                    </span>
                    <span id="server-info" class="info-badge">Loading...</span>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="text">
                üìù Text
            </button>
            <button class="tab-btn" data-tab="map">
                üó∫Ô∏è Map
            </button>
            <button class="tab-btn" data-tab="list">
                üìã List
            </button>
            <button class="tab-btn" data-tab="counter">
                üî¢ Counter
            </button>
            <button class="tab-btn" data-tab="cursor">
                üéØ Cursor
            </button>
            <button class="tab-btn" data-tab="history">
                üìö History
            </button>
            <button class="tab-btn" data-tab="sync">
                üîÑ Sync (M1)
            </button>
            <button class="tab-btn" data-tab="richtext">
                ‚ú® RichText (M2)
            </button>
        </nav>

        <!-- Tab Content -->
        <main class="tab-content">
            <!-- M0: Text CRDT -->
            <div id="tab-text" class="tab-pane active">
                <div id="component-crdt_text"></div>
            </div>

            <!-- M0: Map -->
            <div id="tab-map" class="tab-pane">
                <div id="component-crdt_map"></div>
            </div>

            <!-- M0: List -->
            <div id="tab-list" class="tab-pane">
                <div id="component-crdt_list"></div>
            </div>

            <!-- M0: Counter -->
            <div id="tab-counter" class="tab-pane">
                <div id="component-crdt_counter"></div>
            </div>

            <!-- Cursor Operations -->
            <div id="tab-cursor" class="tab-pane">
                <div id="component-crdt_cursor"></div>
            </div>

            <!-- History -->
            <div id="tab-history" class="tab-pane">
                <div id="component-crdt_history"></div>
            </div>

            <!-- M1: Sync -->
            <div id="tab-sync" class="tab-pane">
                <div id="component-crdt_sync"></div>
            </div>

            <!-- M2: RichText -->
            <div id="tab-richtext" class="tab-pane">
                <div id="component-crdt_richtext"></div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p>
                Automerge WASI Example |
                <a href="https://github.com/joeblew999/automerge-wazero-example" target="_blank">GitHub</a> |
                Perfect 1:1 mapping: Rust WASI ‚Üî Go FFI ‚Üî Go API ‚Üî Go Server ‚Üî HTTP ‚Üî Web Components
            </p>
        </footer>
    </div>

    <!-- Load Automerge.js (built from source) -->
    <script src="/vendor/automerge.js"></script>

    <!-- Load App (ES6 modules) -->
    <script type="module">
        // Load component HTML files dynamically
        async function loadComponent(name) {
            try {
                const response = await fetch(`/web/components/${name}.html`);
                if (!response.ok) {
                    throw new Error(`Failed to load ${name} component`);
                }
                const html = await response.text();
                const container = document.getElementById(`component-${name}`);
                if (container) {
                    container.innerHTML = html;
                }
            } catch (error) {
                console.error(`Error loading ${name} component:`, error);
            }
        }

        // Load all components
        Promise.all([
            loadComponent('crdt_text'),
            loadComponent('crdt_map'),
            loadComponent('crdt_list'),
            loadComponent('crdt_counter'),
            loadComponent('crdt_cursor'),
            loadComponent('crdt_history'),
            loadComponent('crdt_sync'),
            loadComponent('crdt_richtext'),
        ]).then(() => {
            console.log('‚úÖ All components loaded');
            // Now load the main app
            import('/web/js/app.js');
        }).catch(error => {
            console.error('Error loading components:', error);
        });
    </script>
</body>
</html>
